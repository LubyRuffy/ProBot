<!DOCTYPE html>
<html lang='en'>
	<head>
		<title>ProBot</title>
		<meta charset='utf-8'>
        	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        	<meta name="description" content="">
		<link rel="stylesheet" type="text/css" href="css/style_video_template.css">
        	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
		<meta name = 'viewport' content = 'width-device-width, initial-scale=1.0'>
		<link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>
        	<link rel="stylesheet" href="http://yoannmoinet.github.io/nipplejs/stylesheets/styles.css" media="screen" title="no title" charset="utf-8">
        	<link rel="stylesheet" href="http://yoannmoinet.github.io/nipplejs/stylesheets/github-light.css" media="screen" title="no title" charset="utf-8">
		<script src="jquery-1.11.2.js"></script>
		<script type="text/javascript" src="https://js.stripe.com/v2/"></script>

	<style>
        html, body {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 0;
            margin: 0;
        }

	#left {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 50%;
            background: rgba(0, 0, 0, 0);
        }
        
        #right {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 50%;
            background: rgba(0, 0, 0, 0);
        }
        
        #main{
            top: 10%;
            margin-left: 10%; 
            width:80%; 
            height:700px
        }

        </style>

      	</head>

	<body onload="checkVariable()">


    	<div id="strip" >
        	<div class = "centerText">ProBot</div>
    	</div>

    	<div style=" top: 10%; margin-left: 10%; width:80%; height:600px" id = 'main' class='main' >
        	<iframe src="https://videolink2.me/o/b5e7c982" frameborder="0" scrolling="yes"></iframe>    
    	</div>

    	<div style="top:70%;text-align: center; position:relative; width: 100%; border-width: 1px 0 0 0; ">
        	<p><h2>Choose the device that you want to control the ProBot. To change your choice, refresh the Webpage.</h2>.</p>
        	<button id="keyboard" onclick="myFunction()">keyboard</button>
        	<button id="joystick" onclick="myFunction1()">joystick</button>
    	</div>


	<script type="text/javascript">

	var socket = null;
	var isopen = false;
	var noclicks=0;
	var dirFR=200;
	var dirLR=500;

	socket = new WebSocket("ws://192.168.10.50:9000");

	socket.onopen = function() {
  		console.log("Connected!");
  		isopen = true;
	}


	function checkVariable(){
    		setTimeout(function(){
        	socket.send(noclicks);
        	checkVariable();

    	}, 100);
	}

	function myFunction() {
	document.onkeydown = checkKey;

	function checkKey(e) {

    	e = e || window.event;

    	if (e.keyCode == '38') {
        	dirFR=dirFR+8;
        	if (dirFR>=275){
            		dirFR=275;
        	}
        	if (dirFR<=125){
            		dirFR=125;
        	}
        	if (isopen) {
            		socket.send(dirFR);
			   
        	} 
        
   
    		noclicks=dirFR;
    	}
    	else if (e.keyCode == '40') {
        	dirFR=dirFR-8;
        	if (dirFR>=275){
            		dirFR=275;
        	}
        	if (dirFR<=125){
            		dirFR=125;
        	}
        	if (isopen) {
            		socket.send(dirFR);
			
            
         	} 
       
    		noclicks=dirFR;
    	}
    	else if (e.keyCode == '37') {
        	dirLR=dirLR+6;
        	if (dirLR>=575){
            		dirLR=575;
        	}
        	if (dirLR<=425){
            		dirLR=425;
        	}
        	if (isopen) {
            		socket.send(dirLR);
			
        	} 
        
    		noclicks=dirLR;
    	}
    	else if (e.keyCode == '39') {
        	dirLR=dirLR-6;
        	if (dirLR>=575){
            		dirLR=575;
        	}
        	if (dirLR<=425){
            		dirLR=425;
        	}
        	if (isopen) {
            		socket.send(dirLR);
			    
         	} 
        
    		noclicks=dirLR;
    		}

	}

	document.onkeyup = checkKey1
        function checkKey1(e) {
    	
    	e = e || window.event;

    	if (e.keyCode == '38') {
        	dirFR=200;
        	if (isopen) {
			
           		socket.send(dirFR);
         	}
    	}

    	else if (e.keyCode == '40') {
        	dirFR=200;
        	if (isopen) {

	                socket.send(dirFR);

         	}
        
    	}
    	
    	else if (e.keyCode == '37') {
        	dirLR=500;
        	if (isopen) {
            		socket.send(dirLR);
			
         	}
	}

    	else if (e.keyCode == '39') {
        	dirLR=500;
        	if (isopen) {
            		socket.send(dirLR);
         		
		}
      
    	}

    }
	nocliks=0;
   	document.getElementById("keyboard").disabled = true;
   	document.getElementById("joystick").disabled = true;
	}


	function myFunction1() {
    	var hasGP = false;
    	var repGP;
 
    	function canGame() {
        	return "getGamepads" in navigator;

    	}
 
	function reportOnGamepad() {
        var gp = navigator.getGamepads()[0];
        var html = "";
            html += "id: "+gp.id+"<br/>";
 
        for(var i=0;i<gp.buttons.length;i++) {
            html+= "Button "+(i+1)+": ";
            if(gp.buttons[i].pressed) html+= " pressed";
            html+= "<br/>";
        }
 
        for(var i=0;i<gp.axes.length; i+=2) {
            html+= "Stick "+(Math.ceil(i/2)+1)+": "+gp.axes[i]+","+gp.axes[i+1]+"<br/>";
            
            if (isopen) {
            socket.send((gp.axes[1]*-75)+200);
            socket.send((gp.axes[2]*-75)+500);
            noclicks=1;
            } 
            
        }

        $("#gamepadDisplay").html(html);
    	}
 
    	$(document).ready(function() {
 
        if(canGame()) {
 
            var prompt = "To begin using your gamepad, connect it and press any button!";
            $("#gamepadPrompt").text(prompt);
 
            $(window).on("gamepadconnected", function() {
                hasGP = true;
                $("#gamepadPrompt").html("Gamepad connected!");
                console.log("connection event");
                repGP = window.setInterval(reportOnGamepad,200);
            });
 
            $(window).on("gamepaddisconnected", function() {
                console.log("disconnection event");
                $("#gamepadPrompt").text(prompt);
                window.clearInterval(repGP);
            });
 
            //setup an interval for Chrome
            var checkGP = window.setInterval(function() {
                console.log('checkGP');
                if(navigator.getGamepads()[0]) {
                    if(!hasGP) $(window).trigger("gamepadconnected");
                    window.clearInterval(checkGP);
                }
            }, 500);
        }
 
    	});

    	document.getElementById("joystick").disabled = true;
    	document.getElementById("keyboard").disabled = true;
    	}

    	</script>
    	
	</body>
</html>
